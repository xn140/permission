/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2018-06-03 14:11:08 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.WEB_002dINF.views;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class dept_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\n");
      out.write("<html>\n");
      out.write("<head>\n");
      out.write("    <title>部门管理</title>\n");
      out.write("    ");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/common/backend_common.jsp", out, false);
      out.write("\n");
      out.write("    ");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "/common/page.jsp", out, false);
      out.write("\n");
      out.write("</head>\n");
      out.write("<body class=\"no-skin\" youdao=\"bind\" style=\"background: white\">\n");
      out.write("<input id=\"gritter-light\" checked=\"\" type=\"checkbox\" class=\"ace ace-switch ace-switch-5\"/>\n");
      out.write("\n");
      out.write("<div class=\"page-header\">\n");
      out.write("    <h1>\n");
      out.write("        用户管理\n");
      out.write("        <small>\n");
      out.write("            <i class=\"ace-icon fa fa-angle-double-right\"></i>\n");
      out.write("            维护部门与用户关系\n");
      out.write("        </small>\n");
      out.write("    </h1>\n");
      out.write("</div>\n");
      out.write("<div class=\"main-content-inner\">\n");
      out.write("    <div class=\"col-sm-3\">\n");
      out.write("        <div class=\"table-header\">\n");
      out.write("            部门列表&nbsp;&nbsp;\n");
      out.write("            <a class=\"green\" href=\"#\">\n");
      out.write("                <i class=\"ace-icon fa fa-plus-circle orange bigger-130 dept-add\"></i>\n");
      out.write("            </a>\n");
      out.write("        </div>\n");
      out.write("        <div id=\"deptList\">\n");
      out.write("        </div>\n");
      out.write("    </div>\n");
      out.write("    <div class=\"col-sm-9\">\n");
      out.write("        <div class=\"col-xs-12\">\n");
      out.write("            <div class=\"table-header\">\n");
      out.write("                用户列表&nbsp;&nbsp;\n");
      out.write("                <a class=\"green\" href=\"#\">\n");
      out.write("                    <i class=\"ace-icon fa fa-plus-circle orange bigger-130 user-add\"></i>\n");
      out.write("                </a>\n");
      out.write("            </div>\n");
      out.write("            <div>\n");
      out.write("                <div id=\"dynamic-table_wrapper\" class=\"dataTables_wrapper form-inline no-footer\">\n");
      out.write("                    <div class=\"row\">\n");
      out.write("                        <div class=\"col-xs-6\">\n");
      out.write("                            <div class=\"dataTables_length\" id=\"dynamic-table_length\"><label>\n");
      out.write("                                展示\n");
      out.write("                                <select id=\"pageSize\" name=\"dynamic-table_length\" aria-controls=\"dynamic-table\" class=\"form-control input-sm\">\n");
      out.write("                                    <option value=\"10\">10</option>\n");
      out.write("                                    <option value=\"25\">25</option>\n");
      out.write("                                    <option value=\"50\">50</option>\n");
      out.write("                                    <option value=\"100\">100</option>\n");
      out.write("                                </select> 条记录 </label>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                    <table id=\"dynamic-table\" class=\"table table-striped table-bordered table-hover dataTable no-footer\" role=\"grid\"\n");
      out.write("                           aria-describedby=\"dynamic-table_info\" style=\"font-size:14px\">\n");
      out.write("                        <thead>\n");
      out.write("                        <tr role=\"row\">\n");
      out.write("                            <th tabindex=\"0\" aria-controls=\"dynamic-table\" rowspan=\"1\" colspan=\"1\">\n");
      out.write("                                姓名\n");
      out.write("                            </th>\n");
      out.write("                            <th tabindex=\"0\" aria-controls=\"dynamic-table\" rowspan=\"1\" colspan=\"1\">\n");
      out.write("                                所属部门\n");
      out.write("                            </th>\n");
      out.write("                            <th tabindex=\"0\" aria-controls=\"dynamic-table\" rowspan=\"1\" colspan=\"1\">\n");
      out.write("                                邮箱\n");
      out.write("                            </th>\n");
      out.write("                            <th tabindex=\"0\" aria-controls=\"dynamic-table\" rowspan=\"1\" colspan=\"1\">\n");
      out.write("                                电话\n");
      out.write("                            </th>\n");
      out.write("                            <th tabindex=\"0\" aria-controls=\"dynamic-table\" rowspan=\"1\" colspan=\"1\">\n");
      out.write("                                状态\n");
      out.write("                            </th>\n");
      out.write("                            <th class=\"sorting_disabled\" rowspan=\"1\" colspan=\"1\" aria-label=\"\"></th>\n");
      out.write("                        </tr>\n");
      out.write("                        </thead>\n");
      out.write("                        <tbody id=\"userList\"></tbody>\n");
      out.write("                    </table>\n");
      out.write("                    <div class=\"row\" id=\"userPage\">\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("        </div>\n");
      out.write("    </div>\n");
      out.write("</div>\n");
      out.write("<div id=\"dialog-dept-form\" style=\"display: none;\">\n");
      out.write("    <form id=\"deptForm\">\n");
      out.write("        <table class=\"table table-striped table-bordered table-hover dataTable no-footer\" role=\"grid\">\n");
      out.write("            <tr>\n");
      out.write("                <td style=\"width: 80px;\"><label for=\"parentId\">上级部门</label></td>\n");
      out.write("                <td>\n");
      out.write("                    <select id=\"parentId\" name=\"parentId\" data-placeholder=\"选择部门\" style=\"width: 200px;\"></select>\n");
      out.write("                    <input type=\"hidden\" name=\"id\" id=\"deptId\"/>\n");
      out.write("                </td>\n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <td><label for=\"deptName\">名称</label></td>\n");
      out.write("                <td><input type=\"text\" name=\"name\" id=\"deptName\" value=\"\" class=\"text ui-widget-content ui-corner-all\"></td>\n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <td><label for=\"deptSeq\">顺序</label></td>\n");
      out.write("                <td><input type=\"text\" name=\"seq\" id=\"deptSeq\" value=\"1\" class=\"text ui-widget-content ui-corner-all\"></td>\n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <td><label for=\"deptRemark\">备注</label></td>\n");
      out.write("                <td><textarea name=\"remark\" id=\"deptRemark\" class=\"text ui-widget-content ui-corner-all\" rows=\"3\" cols=\"25\"></textarea></td>\n");
      out.write("            </tr>\n");
      out.write("        </table>\n");
      out.write("    </form>\n");
      out.write("</div>\n");
      out.write("<div id=\"dialog-user-form\" style=\"display: none;\">\n");
      out.write("    <form id=\"userForm\">\n");
      out.write("        <table class=\"table table-striped table-bordered table-hover dataTable no-footer\" role=\"grid\">\n");
      out.write("            <tr>\n");
      out.write("                <td style=\"width: 80px;\"><label for=\"parentId\">所在部门</label></td>\n");
      out.write("                <td>\n");
      out.write("                    <select id=\"deptSelectId\" name=\"deptId\" data-placeholder=\"选择部门\" style=\"width: 200px;\"></select>\n");
      out.write("                </td>\n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <td><label for=\"userName\">名称</label></td>\n");
      out.write("                <input type=\"hidden\" name=\"id\" id=\"userId\"/>\n");
      out.write("                <td><input type=\"text\" name=\"username\" id=\"userName\" value=\"\" class=\"text ui-widget-content ui-corner-all\"></td>\n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <td><label for=\"userMail\">邮箱</label></td>\n");
      out.write("                <td><input type=\"text\" name=\"mail\" id=\"userMail\" value=\"\" class=\"text ui-widget-content ui-corner-all\"></td>\n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <td><label for=\"userTelephone\">电话</label></td>\n");
      out.write("                <td><input type=\"text\" name=\"telephone\" id=\"userTelephone\" value=\"\" class=\"text ui-widget-content ui-corner-all\"></td>\n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <td><label for=\"userStatus\">状态</label></td>\n");
      out.write("                <td>\n");
      out.write("                    <select id=\"userStatus\" name=\"status\" data-placeholder=\"选择状态\" style=\"width: 150px;\">\n");
      out.write("                        <option value=\"1\">有效</option>\n");
      out.write("                        <option value=\"0\">无效</option>\n");
      out.write("                        <option value=\"2\">删除</option>\n");
      out.write("                    </select>\n");
      out.write("                </td>\n");
      out.write("            </tr>\n");
      out.write("            <tr>\n");
      out.write("                <td><label for=\"userRemark\">备注</label></td>\n");
      out.write("                <td><textarea name=\"remark\" id=\"userRemark\" class=\"text ui-widget-content ui-corner-all\" rows=\"3\" cols=\"25\"></textarea></td>\n");
      out.write("            </tr>\n");
      out.write("        </table>\n");
      out.write("    </form>\n");
      out.write("</div>\n");
      out.write("\n");
      out.write("<script id=\"deptListTemplate\" type=\"x-tmpl-mustache\">\n");
      out.write("<ol class=\"dd-list\">\n");
      out.write("    {{#deptList}}\n");
      out.write("        <li class=\"dd-item dd2-item dept-name\" id=\"dept_{{id}}\" href=\"javascript:void(0)\" data-id=\"{{id}}\">\n");
      out.write("            <div class=\"dd2-content\" style=\"cursor:pointer;\">\n");
      out.write("            {{name}}\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("            <span style=\"float:right;\">\n");
      out.write("                <a class=\"green dept-edit\" href=\"#\" data-id=\"{{id}}\" >\n");
      out.write("                    <i class=\"ace-icon fa fa-pencil bigger-100\"></i>\n");
      out.write("                </a>\n");
      out.write("                &nbsp;\n");
      out.write("                <a class=\"red dept-delete\" href=\"#\" data-id=\"{{id}}\" data-name=\"{{name}}\">\n");
      out.write("                    <i class=\"ace-icon fa fa-trash-o bigger-100\"></i>\n");
      out.write("                </a>\n");
      out.write("            </span>\n");
      out.write("            </div>\n");
      out.write("        </li>\n");
      out.write("    {{/deptList}}\n");
      out.write("</ol>\n");
      out.write("</script>\n");
      out.write("<script id=\"userListTemplate\" type=\"x-tmpl-mustache\">\n");
      out.write("{{#userList}}\n");
      out.write("<tr role=\"row\" class=\"user-name odd\" data-id=\"{{id}}\"><!--even -->\n");
      out.write("    <td><a href=\"#\" class=\"user-edit\" data-id=\"{{id}}\">{{username}}</a></td>\n");
      out.write("    <td>{{showDeptName}}</td>\n");
      out.write("    <td>{{mail}}</td>\n");
      out.write("    <td>{{telephone}}</td>\n");
      out.write("    <td>{{#bold}}{{showStatus}}{{/bold}}</td> <!-- 此处套用函数对status做特殊处理 -->\n");
      out.write("    <td>\n");
      out.write("        <div class=\"hidden-sm hidden-xs action-buttons\">\n");
      out.write("            <a class=\"green user-edit\" href=\"#\" data-id=\"{{id}}\">\n");
      out.write("                <i class=\"ace-icon fa fa-pencil bigger-100\"></i>\n");
      out.write("            </a>\n");
      out.write("            <a class=\"red user-acl\" href=\"#\" data-id=\"{{id}}\">\n");
      out.write("                <i class=\"ace-icon fa fa-flag bigger-100\"></i>\n");
      out.write("            </a>\n");
      out.write("        </div>\n");
      out.write("    </td>\n");
      out.write("</tr>\n");
      out.write("{{/userList}}\n");
      out.write("</script>\n");
      out.write("\n");
      out.write("<script type=\"application/javascript\">\n");
      out.write("    $(function() {\n");
      out.write("\n");
      out.write("        var deptList; // 存储树形部门列表\n");
      out.write("        var deptMap = {}; // 存储map格式的部门信息\n");
      out.write("        var userMap = {}; // 存储map格式的用户信息\n");
      out.write("        var optionStr = \"\";\n");
      out.write("        var lastClickDeptId = -1;\n");
      out.write("\n");
      out.write("        var deptListTemplate = $('#deptListTemplate').html();\n");
      out.write("        Mustache.parse(deptListTemplate);\n");
      out.write("        var userListTemplate = $('#userListTemplate').html();\n");
      out.write("        Mustache.parse(userListTemplate);\n");
      out.write("\n");
      out.write("        loadDeptTree();\n");
      out.write("\n");
      out.write("        function loadDeptTree() {\n");
      out.write("            $.ajax({\n");
      out.write("                url: \"/sys/dept/tree.json\",\n");
      out.write("                success : function (result) {\n");
      out.write("                    if (result.ret) {\n");
      out.write("                        deptList = result.data;\n");
      out.write("                        var rendered = Mustache.render(deptListTemplate, {\n");
      out.write("                            deptList: result.data\n");
      out.write("                          /*  \"showDownAngle\": function () {\n");
      out.write("                                return function (text, render) {\n");
      out.write("                                    return (this.deptList && this.deptList.length > 0) ? \"\" : \"hidden\";\n");
      out.write("                                }\n");
      out.write("                            },\n");
      out.write("                            \"displayClass\": function () {\n");
      out.write("                                return \"\";\n");
      out.write("                            }\n");
      out.write("*/\n");
      out.write("                        });\n");
      out.write("\n");
      out.write("                        $(\"#deptList\").html(rendered);\n");
      out.write("                        recursiveRenderDept(result.data);\n");
      out.write("                        bindDeptClick();\n");
      out.write("                    } else {\n");
      out.write("                        showMessage(\"加载部门列表\", result.msg, false);\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            })\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        // 递归渲染部门树\n");
      out.write("        function recursiveRenderDept(deptList) {\n");
      out.write("            if(deptList && deptList.length > 0) {\n");
      out.write("                $(deptList).each(function (i, dept) {\n");
      out.write("                     deptMap[dept.id] = dept;\n");
      out.write("                     if (dept.deptList.length > 0) {\n");
      out.write("                         var rendered = Mustache.render(deptListTemplate, {deptList: dept.deptList});\n");
      out.write("                         $(\"#dept_\" + dept.id).append(rendered);\n");
      out.write("                         recursiveRenderDept(dept.deptList);\n");
      out.write("                     }\n");
      out.write("                })\n");
      out.write("            }\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        // 绑定部门点击事件\n");
      out.write("        function bindDeptClick() {\n");
      out.write("\n");
      out.write("            $(\".dept-name\").click(function(e) {\n");
      out.write("                e.preventDefault();\n");
      out.write("                e.stopPropagation();\n");
      out.write("                var deptId = $(this).attr(\"data-id\");\n");
      out.write("                handleDepSelected(deptId);\n");
      out.write("            });\n");
      out.write("\n");
      out.write("            $(\".dept-delete\").click(function (e) {\n");
      out.write("                e.preventDefault();\n");
      out.write("                e.stopPropagation();\n");
      out.write("                var deptId = $(this).attr(\"data-id\");\n");
      out.write("                var deptName = $(this).attr(\"data-name\");\n");
      out.write("                if (confirm(\"确定要删除部门[\" + deptName + \"]吗?\")) {\n");
      out.write("                    $.ajax({\n");
      out.write("                        url: \"/sys/dept/delete.json\",\n");
      out.write("                        data: {\n");
      out.write("                            id: deptId\n");
      out.write("                        },\n");
      out.write("                        success: function (result) {\n");
      out.write("                            if (result.ret) {\n");
      out.write("                                showMessage(\"删除部门[\" + deptName + \"]\", \"操作成功\", true);\n");
      out.write("                                loadDeptTree();\n");
      out.write("                            } else {\n");
      out.write("                                showMessage(\"删除部门[\" + deptName + \"]\", result.msg, false);\n");
      out.write("                            }\n");
      out.write("                        }\n");
      out.write("                    });\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("\n");
      out.write("            $(\".dept-edit\").click(function(e) {\n");
      out.write("                e.preventDefault();\n");
      out.write("                e.stopPropagation();\n");
      out.write("                var deptId = $(this).attr(\"data-id\");\n");
      out.write("                $(\"#dialog-dept-form\").dialog({\n");
      out.write("                    model: true,\n");
      out.write("                    title: \"编辑部门\",\n");
      out.write("                    open: function(event, ui) {\n");
      out.write("                        $(\".ui-dialog-titlebar-close\", $(this).parent()).hide();\n");
      out.write("                        optionStr = \"<option value=\\\"0\\\">-</option>\";\n");
      out.write("                        recursiveRenderDeptSelect(deptList, 1);\n");
      out.write("                        $(\"#deptForm\")[0].reset();\n");
      out.write("                        $(\"#parentId\").html(optionStr);\n");
      out.write("                        $(\"#deptId\").val(deptId);\n");
      out.write("                        var targetDept = deptMap[deptId];\n");
      out.write("                        if (targetDept) {\n");
      out.write("                            $(\"#parentId\").val(targetDept.parentId);\n");
      out.write("                            $(\"#deptName\").val(targetDept.name);\n");
      out.write("                            $(\"#deptSeq\").val(targetDept.seq);\n");
      out.write("                            $(\"#deptRemark\").val(targetDept.remark);\n");
      out.write("                        }\n");
      out.write("                    },\n");
      out.write("                    buttons : {\n");
      out.write("                        \"更新\": function(e) {\n");
      out.write("                            e.preventDefault();\n");
      out.write("                            updateDept(false, function (data) {\n");
      out.write("                                $(\"#dialog-dept-form\").dialog(\"close\");\n");
      out.write("                            }, function (data) {\n");
      out.write("                                showMessage(\"更新部门\", data.msg, false);\n");
      out.write("                            })\n");
      out.write("                        },\n");
      out.write("                        \"取消\": function () {\n");
      out.write("                            $(\"#dialog-dept-form\").dialog(\"close\");\n");
      out.write("                        }\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("            })\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function handleDepSelected(deptId) {\n");
      out.write("            if (lastClickDeptId != -1) {\n");
      out.write("                var lastDept = $(\"#dept_\" + lastClickDeptId + \" .dd2-content:first\");\n");
      out.write("                lastDept.removeClass(\"btn-yellow\");\n");
      out.write("                lastDept.removeClass(\"no-hover\");\n");
      out.write("            }\n");
      out.write("            var currentDept = $(\"#dept_\" + deptId + \" .dd2-content:first\");\n");
      out.write("            currentDept.addClass(\"btn-yellow\");\n");
      out.write("            currentDept.addClass(\"no-hover\");\n");
      out.write("            lastClickDeptId = deptId;\n");
      out.write("            loadUserList(deptId);\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function loadUserList(deptId) {\n");
      out.write("            var pageSize = $(\"#pageSize\").val();\n");
      out.write("            var url = \"/sys/user/page.json?deptId=\" + deptId;\n");
      out.write("            var pageNo = $(\"#userPage .pageNo\").val() || 1;\n");
      out.write("            $.ajax({\n");
      out.write("                url : url,\n");
      out.write("                data: {\n");
      out.write("                    pageSize: pageSize,\n");
      out.write("                    pageNo: pageNo\n");
      out.write("                },\n");
      out.write("                success: function (result) {\n");
      out.write("                    renderUserListAndPage(result, url);\n");
      out.write("                }\n");
      out.write("            })\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function renderUserListAndPage(result, url) {\n");
      out.write("            if (result.ret) {\n");
      out.write("                if (result.data.total > 0){\n");
      out.write("                    var rendered = Mustache.render(userListTemplate, {\n");
      out.write("                        userList: result.data.data,\n");
      out.write("                        \"showDeptName\": function() {\n");
      out.write("                            return deptMap[this.deptId].name;\n");
      out.write("                        },\n");
      out.write("                        \"showStatus\": function() {\n");
      out.write("                            return this.status == 1 ? '有效' : (this.status == 0 ? '无效' : '删除');\n");
      out.write("                        },\n");
      out.write("                        \"bold\": function() {\n");
      out.write("                            return function(text, render) {\n");
      out.write("                                var status = render(text);\n");
      out.write("                                if (status == '有效') {\n");
      out.write("                                    return \"<span class='label label-sm label-success'>有效</span>\";\n");
      out.write("                                } else if(status == '无效') {\n");
      out.write("                                    return \"<span class='label label-sm label-warning'>无效</span>\";\n");
      out.write("                                } else {\n");
      out.write("                                    return \"<span class='label'>删除</span>\";\n");
      out.write("                                }\n");
      out.write("                            }\n");
      out.write("                        }\n");
      out.write("                    });\n");
      out.write("                    $(\"#userList\").html(rendered);\n");
      out.write("                    bindUserClick();\n");
      out.write("                    $.each(result.data.data, function(i, user) {\n");
      out.write("                        userMap[user.id] = user;\n");
      out.write("                    })\n");
      out.write("                } else {\n");
      out.write("                    $(\"#userList\").html('');\n");
      out.write("                }\n");
      out.write("                var pageSize = $(\"#pageSize\").val();\n");
      out.write("                var pageNo = $(\"#userPage .pageNo\").val() || 1;\n");
      out.write("                renderPage(url, result.data.total, pageNo, pageSize, result.data.total > 0 ? result.data.data.length : 0, \"userPage\", renderUserListAndPage);\n");
      out.write("            } else {\n");
      out.write("                showMessage(\"获取部门下用户列表\", result.msg, false);\n");
      out.write("            }\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        $(\".user-add\").click(function() {\n");
      out.write("            $(\"#dialog-user-form\").dialog({\n");
      out.write("                model: true,\n");
      out.write("                title: \"新增用户\",\n");
      out.write("                open: function(event, ui) {\n");
      out.write("                    $(\".ui-dialog-titlebar-close\", $(this).parent()).hide();\n");
      out.write("                    optionStr = \"\";\n");
      out.write("                    recursiveRenderDeptSelect(deptList, 1);\n");
      out.write("                    $(\"#userForm\")[0].reset();\n");
      out.write("                    $(\"#deptSelectId\").html(optionStr);\n");
      out.write("                },\n");
      out.write("                buttons : {\n");
      out.write("                    \"添加\": function(e) {\n");
      out.write("                        e.preventDefault();\n");
      out.write("                        updateUser(true, function (data) {\n");
      out.write("                            $(\"#dialog-user-form\").dialog(\"close\");\n");
      out.write("                            loadUserList(lastClickDeptId);\n");
      out.write("                        }, function (data) {\n");
      out.write("                            showMessage(\"新增用户\", data.msg, false);\n");
      out.write("                        })\n");
      out.write("                    },\n");
      out.write("                    \"取消\": function () {\n");
      out.write("                        $(\"#dialog-user-form\").dialog(\"close\");\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("        });\n");
      out.write("        function bindUserClick() {\n");
      out.write("            $(\".user-acl\").click(function (e) {\n");
      out.write("                e.preventDefault();\n");
      out.write("                e.stopPropagation();\n");
      out.write("                var userId = $(this).attr(\"data-id\");\n");
      out.write("                $.ajax({\n");
      out.write("                    url: \"/sys/user/acls.json\",\n");
      out.write("                    data: {\n");
      out.write("                        userId: userId\n");
      out.write("                    },\n");
      out.write("                    success: function(result) {\n");
      out.write("                        if (result.ret) {\n");
      out.write("                            console.log(result)\n");
      out.write("                        } else {\n");
      out.write("                            showMessage(\"获取用户权限数据\", result.msg, false);\n");
      out.write("                        }\n");
      out.write("                    }\n");
      out.write("                })\n");
      out.write("            });\n");
      out.write("            $(\".user-edit\").click(function(e) {\n");
      out.write("                e.preventDefault();\n");
      out.write("                e.stopPropagation();\n");
      out.write("                var userId = $(this).attr(\"data-id\");\n");
      out.write("                $(\"#dialog-user-form\").dialog({\n");
      out.write("                    model: true,\n");
      out.write("                    title: \"编辑用户\",\n");
      out.write("                    open: function(event, ui) {\n");
      out.write("                        $(\".ui-dialog-titlebar-close\", $(this).parent()).hide();\n");
      out.write("                        optionStr = \"\";\n");
      out.write("                        recursiveRenderDeptSelect(deptList, 1);\n");
      out.write("                        $(\"#userForm\")[0].reset();\n");
      out.write("                        $(\"#deptSelectId\").html(optionStr);\n");
      out.write("\n");
      out.write("                        var targetUser = userMap[userId];\n");
      out.write("                        if (targetUser) {\n");
      out.write("                            $(\"#deptSelectId\").val(targetUser.deptId);\n");
      out.write("                            $(\"#userName\").val(targetUser.username);\n");
      out.write("                            $(\"#userMail\").val(targetUser.mail);\n");
      out.write("                            $(\"#userTelephone\").val(targetUser.telephone);\n");
      out.write("                            $(\"#userStatus\").val(targetUser.status);\n");
      out.write("                            $(\"#userRemark\").val(targetUser.remark);\n");
      out.write("                            $(\"#userId\").val(targetUser.id);\n");
      out.write("                        }\n");
      out.write("                    },\n");
      out.write("                    buttons : {\n");
      out.write("                        \"更新\": function(e) {\n");
      out.write("                            e.preventDefault();\n");
      out.write("                            updateUser(false, function (data) {\n");
      out.write("                                $(\"#dialog-user-form\").dialog(\"close\");\n");
      out.write("                                loadUserList(lastClickDeptId);\n");
      out.write("                            }, function (data) {\n");
      out.write("                                showMessage(\"更新用户\", data.msg, false);\n");
      out.write("                            })\n");
      out.write("                        },\n");
      out.write("                        \"取消\": function () {\n");
      out.write("                            $(\"#dialog-user-form\").dialog(\"close\");\n");
      out.write("                        }\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("            });\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        $(\".dept-add\").click(function() {\n");
      out.write("            $(\"#dialog-dept-form\").dialog({\n");
      out.write("                model: true,\n");
      out.write("                title: \"新增部门\",\n");
      out.write("                open: function(event, ui) {\n");
      out.write("                    $(\".ui-dialog-titlebar-close\", $(this).parent()).hide();\n");
      out.write("                    optionStr = \"<option value=\\\"0\\\">-</option>\";\n");
      out.write("                    recursiveRenderDeptSelect(deptList, 1);\n");
      out.write("                    $(\"#deptForm\")[0].reset();\n");
      out.write("                    $(\"#parentId\").html(optionStr);\n");
      out.write("                },\n");
      out.write("                buttons : {\n");
      out.write("                    \"添加\": function(e) {\n");
      out.write("                        e.preventDefault();\n");
      out.write("                        updateDept(true, function (data) {\n");
      out.write("                            $(\"#dialog-dept-form\").dialog(\"close\");\n");
      out.write("                        }, function (data) {\n");
      out.write("                            showMessage(\"新增部门\", data.msg, false);\n");
      out.write("                        })\n");
      out.write("                    },\n");
      out.write("                    \"取消\": function () {\n");
      out.write("                        $(\"#dialog-dept-form\").dialog(\"close\");\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("        });\n");
      out.write("\n");
      out.write("        function recursiveRenderDeptSelect(deptList, level) {\n");
      out.write("            level = level | 0;\n");
      out.write("            if (deptList && deptList.length > 0) {\n");
      out.write("                $(deptList).each(function (i, dept) {\n");
      out.write("                    deptMap[dept.id] = dept;\n");
      out.write("                    var blank = \"\";\n");
      out.write("                    if (level > 1) {\n");
      out.write("                        for(var j = 3; j <= level; j++) {\n");
      out.write("                            blank += \"..\";\n");
      out.write("                        }\n");
      out.write("                        blank += \"∟\";\n");
      out.write("                    }\n");
      out.write("                    optionStr += Mustache.render(\"<option value='{{id}}'>{{name}}</option>\", {id: dept.id, name: blank + dept.name});\n");
      out.write("                    if (dept.deptList && dept.deptList.length > 0) {\n");
      out.write("                        recursiveRenderDeptSelect(dept.deptList, level + 1);\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("            }\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function updateUser(isCreate, successCallback, failCallback) {\n");
      out.write("            $.ajax({\n");
      out.write("                url: isCreate ? \"/sys/user/save.json\" : \"/sys/user/update.json\",\n");
      out.write("                data: $(\"#userForm\").serializeArray(),\n");
      out.write("                type: 'POST',\n");
      out.write("                success: function(result) {\n");
      out.write("                    if (result.ret) {\n");
      out.write("                        loadDeptTree();\n");
      out.write("                        if (successCallback) {\n");
      out.write("                            successCallback(result);\n");
      out.write("                        }\n");
      out.write("                    } else {\n");
      out.write("                        if (failCallback) {\n");
      out.write("                            failCallback(result);\n");
      out.write("                        }\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            })\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function updateDept(isCreate, successCallback, failCallback) {\n");
      out.write("            $.ajax({\n");
      out.write("                url: isCreate ? \"/sys/dept/save.json\" : \"/sys/dept/update.json\",\n");
      out.write("                data: $(\"#deptForm\").serializeArray(),\n");
      out.write("                type: 'POST',\n");
      out.write("                success: function(result) {\n");
      out.write("                    if (result.ret) {\n");
      out.write("                        loadDeptTree();\n");
      out.write("                        if (successCallback) {\n");
      out.write("                            successCallback(result);\n");
      out.write("                        }\n");
      out.write("                    } else {\n");
      out.write("                        if (failCallback) {\n");
      out.write("                            failCallback(result);\n");
      out.write("                        }\n");
      out.write("                    }\n");
      out.write("                }\n");
      out.write("            })\n");
      out.write("        }\n");
      out.write("    })\n");
      out.write("</script>\n");
      out.write("</body>\n");
      out.write("</html>\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
